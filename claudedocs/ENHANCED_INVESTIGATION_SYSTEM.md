# ë³´ê°• ìˆ˜ì‚¬ ì‹œìŠ¤í…œ ì„¤ê³„ ë¬¸ì„œ

> **ì‘ì„±ì¼**: 2025-10-06
> **ëª©ì **: ë³µì¡í•œ ë³´ê°• ìˆ˜ì‚¬ ì‹œìŠ¤í…œì˜ ì™„ì „í•œ ì„¤ê³„ ë° êµ¬í˜„ ê°€ì´ë“œ
> **ë‚œì´ë„**: â­â­â­â­â­ (ë§¤ìš° ë†’ìŒ - ì‹ ì¤‘í•œ êµ¬í˜„ í•„ìš”)

---

## ğŸ“‹ ëª©ì°¨

1. [ì‹œìŠ¤í…œ ê°œìš”](#1-ì‹œìŠ¤í…œ-ê°œìš”)
2. [íŒŒì¼ ë¶„ë¥˜ ë° ë§¤í•‘](#2-íŒŒì¼-ë¶„ë¥˜-ë°-ë§¤í•‘)
3. [ê²Œì„ í”Œë¡œìš°](#3-ê²Œì„-í”Œë¡œìš°)
4. [ë°ì´í„° êµ¬ì¡° ì„¤ê³„](#4-ë°ì´í„°-êµ¬ì¡°-ì„¤ê³„)
5. [í•µì‹¬ ë¡œì§ êµ¬í˜„](#5-í•µì‹¬-ë¡œì§-êµ¬í˜„)
6. [E15 ì´ë©”ì¼ ì„¤ê³„](#6-e15-ì´ë©”ì¼-ì„¤ê³„)
7. [í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤](#7-í…ŒìŠ¤íŠ¸-ì‹œë‚˜ë¦¬ì˜¤)

---

## 1. ì‹œìŠ¤í…œ ê°œìš”

### 1.1 ë³´ê°• ìˆ˜ì‚¬ë€?

**ê¸°ëŠ¥**: í”Œë ˆì´ì–´ê°€ íŠ¹ì • ì´ë©”ì¼ì— ëŒ€í•´ ì¶”ê°€ ì¡°ì‚¬ë¥¼ ìš”ì²­í•˜ëŠ” ì‹œìŠ¤í…œ

**ë¹„ìš©**: í† í° ì†Œëª¨ (ì˜ˆ: 50 í† í°)

**íš¨ê³¼**: ë‹¤ìŒ ë‚  í•´ë‹¹ ì´ë©”ì¼ì— ìƒˆë¡œìš´ ì²¨ë¶€íŒŒì¼ ì¶”ê°€

### 1.2 ë‘ ê°€ì§€ ë³´ê°• ìˆ˜ì‚¬ íƒ€ì…

#### Type A: ì¼ë°˜ ë³´ê°• ìˆ˜ì‚¬

**ë™ì‘:**
1. Day Nì— ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­
2. Day N+1ì—:
   - ì›ë˜ ì´ë©”ì¼ì´ "ì•ˆì½ìŒ"ìœ¼ë¡œ ë³€ê²½ âœ¨
   - ìƒˆë¡œìš´ ì²¨ë¶€íŒŒì¼ ì¶”ê°€

**ì˜ˆì‹œ:**
- E02 ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­ (Day 1)
- Day 2ì— E02ê°€ "ì•ˆì½ìŒ" + 3ê°œ íŒŒì¼ ì¶”ê°€
  - e02_enhanced_01_garden_report.md
  - e02_enhanced_02_roof_access.md
  - e02_enhanced_03_neighbor_interview.md

#### Type B: Day 5 íŠ¹ìˆ˜ ë³´ê°• ìˆ˜ì‚¬

**ë™ì‘:**
1. Day Nì— ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­
2. Day N+1ì—:
   - **ì¼ë°˜ íŒŒì¼ë§Œ** ì›ë˜ ì´ë©”ì¼ì— ì¶”ê°€
   - **5day íŒŒì¼ì€ ì¶”ê°€ ì•ˆ í•¨** (ë³´ë¥˜)
3. Day 5ì—:
   - E15 íŠ¹ìˆ˜ ì´ë©”ì¼ ë„ì°©
   - **ëª¨ë“  5day íŒŒì¼**ì„ E15ì— ì²¨ë¶€

**ì˜ˆì‹œ:**
- E05 ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­ (Day 2)
- Day 3ì— E05ì— ì¶”ê°€:
  - e05_enhanced_02_witnesses_recheck.md âœ…
  - e05_enhanced_03_delivery_driver.md âœ…
  - e05_5day_enhanced_04_gps_analysis.md âŒ (ì¶”ê°€ ì•ˆ í•¨)
- Day 5ì— E15ì— ì¶”ê°€:
  - e05_5day_enhanced_04_gps_analysis.md âœ…

---

## 2. íŒŒì¼ ë¶„ë¥˜ ë° ë§¤í•‘

### 2.1 Enhanced íŒŒì¼ ì „ì²´ ëª©ë¡

```
assets/enhanced/
â”œâ”€â”€ e02_enhanced_01_garden_report.md           [Type A]
â”œâ”€â”€ e02_enhanced_02_roof_access.md             [Type A]
â”œâ”€â”€ e02_enhanced_03_neighbor_interview.md      [Type A]
â”œâ”€â”€ e05_enhanced_02_witnesses_recheck.md       [Type A]
â”œâ”€â”€ e05_enhanced_03_delivery_driver.md         [Type A]
â”œâ”€â”€ e05_5day_enhanced_04_gps_analysis.md       [Type B] â­
â”œâ”€â”€ e06_5day_enhanced_01_drug_family.md        [Type B] â­
â”œâ”€â”€ e07_5day_enhanced_01_final_warning.md      [Type B] â­
â””â”€â”€ e09_5day_enhanced_01_netflix_log.md        [Type B] â­
```

### 2.2 ì´ë©”ì¼ë³„ ë³´ê°•ìˆ˜ì‚¬ íŒŒì¼ ë§¤í•‘

```json
// assets/data/enhanced_mappings.json
{
  "E02": {
    "normal": [
      "enhanced/e02_enhanced_01_garden_report.md",
      "enhanced/e02_enhanced_02_roof_access.md",
      "enhanced/e02_enhanced_03_neighbor_interview.md"
    ],
    "day5": []
  },
  "E05": {
    "normal": [
      "enhanced/e05_enhanced_02_witnesses_recheck.md",
      "enhanced/e05_enhanced_03_delivery_driver.md"
    ],
    "day5": [
      "enhanced/e05_5day_enhanced_04_gps_analysis.md"
    ]
  },
  "E06": {
    "normal": [],
    "day5": [
      "enhanced/e06_5day_enhanced_01_drug_family.md"
    ]
  },
  "E07": {
    "normal": [],
    "day5": [
      "enhanced/e07_5day_enhanced_01_final_warning.md"
    ]
  },
  "E09": {
    "normal": [],
    "day5": [
      "enhanced/e09_5day_enhanced_01_netflix_log.md"
    ]
  }
}
```

### 2.3 Day 5 íŠ¹ìˆ˜ íŒŒì¼ ì˜ë¯¸ ë¶„ì„

**ëª¨ë“  Day 5 íŒŒì¼ì€ ê²Œì„ í›„ë°˜ë¶€ì˜ ê²°ì •ì  ì¦ê±°ì…ë‹ˆë‹¤:**

| íŒŒì¼ | ì´ë©”ì¼ | ë‚´ìš© | ì¤‘ìš”ë„ |
|------|--------|------|--------|
| e05_5day_enhanced_04_gps_analysis.md | E05 | GPS êµì°¨ ê²€ì¦ - ê¹€ìˆ˜í˜„ ëª¨ë°”ì¼ ì ‘ì† ì˜ë¬¸ | â­â­â­â­â­ |
| e06_5day_enhanced_01_drug_family.md | E06 | í•œì§€ì€ ëª¨ì¹œ ë””ê³¡ì‹  ì²˜ë°© ê¸°ë¡ | â­â­â­â­â­ |
| e07_5day_enhanced_01_final_warning.md | E07 | ìµœí›„í†µì²© ë…¹ì·¨ë¡ - ê¹€ìˆ˜í˜„/ë°•ì¤€ì˜ ë™ê¸° ëª…í™• | â­â­â­â­â­ |
| e09_5day_enhanced_01_netflix_log.md | E09 | ë„·í”Œë¦­ìŠ¤ ë¡œê·¸ - ê¹€ìˆ˜í˜„ ì•Œë¦¬ë°”ì´ ì˜ë¬¸ | â­â­â­â­â­ |

**ê²Œì„ ë””ìì¸ ì˜ë„:**
- Day 1-4: í”Œë ˆì´ì–´ê°€ í˜¼ë€ìŠ¤ëŸ¬ì›€ (ì—¬ëŸ¬ ìš©ì˜ì ê°€ëŠ¥ì„±)
- Day 5: ê²°ì •ì  ì¦ê±° ì œê³µ â†’ ì§„ë²” í™•ì‹ 

---

## 3. ê²Œì„ í”Œë¡œìš°

### 3.1 ì‹œë‚˜ë¦¬ì˜¤ ì˜ˆì‹œ: E05 ë³´ê°•ìˆ˜ì‚¬

**Day 2 (í™”ìš”ì¼)**
```
í”Œë ˆì´ì–´:
1. E05 ì´ë©”ì¼ ìˆ˜ì‹  (ì•Œë¦¬ë°”ì´ í™•ì¸ ê²°ê³¼)
2. E05 ì½ìŒ â†’ ì½ìŒ í‘œì‹œ âœ“
3. ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­ (50 í† í° ì†Œëª¨)

ì‹œìŠ¤í…œ:
- requestedEnhancedInvestigations: ["E05"]
- Day 2 ì¢…ë£Œ
```

**Day 2 â†’ Day 3 ì „í™˜ ì‹œ**
```
ì‹œìŠ¤í…œ ì²˜ë¦¬:
1. E05ê°€ ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­ë¨ í™•ì¸
2. enhanced_mappings.jsonì—ì„œ E05 íŒŒì¼ ì¡°íšŒ:
   - normal: ["e05_enhanced_02_...", "e05_enhanced_03_..."]
   - day5: ["e05_5day_enhanced_04_..."]

3. E05 ì´ë©”ì¼ ìƒíƒœ ë³€ê²½:
   - isRead: false  âœ¨ (ì•ˆì½ìŒìœ¼ë¡œ ë³€ê²½)
   - hasNewEnhancedFiles: true

4. E05 ì²¨ë¶€íŒŒì¼ì— normal íŒŒì¼ë§Œ ì¶”ê°€:
   - e05_enhanced_02_witnesses_recheck.md âœ…
   - e05_enhanced_03_delivery_driver.md âœ…
   - e05_5day_enhanced_04 ëŠ” ì¶”ê°€ ì•ˆ í•¨ âŒ

5. emailEnhancedFiles ì—…ë°ì´íŠ¸:
   {
     "E05": ["e05_enhanced_02", "e05_enhanced_03"]
   }
```

**Day 3 (ìˆ˜ìš”ì¼)**
```
í”Œë ˆì´ì–´:
1. ë©”ì¼í•¨ í™•ì¸
2. E05ê°€ "ì•ˆì½ìŒ" ìƒíƒœë¡œ í‘œì‹œë¨ (ë±ƒì§€ í‘œì‹œ)
3. E05 í´ë¦­ â†’ ìƒˆ ì²¨ë¶€íŒŒì¼ 2ê°œ í™•ì¸
4. ì²¨ë¶€íŒŒì¼ ì½ê¸°
```

**Day 4 (ëª©ìš”ì¼)**
```
ì•„ë¬´ ë³€í™” ì—†ìŒ
```

**Day 4 â†’ Day 5 ì „í™˜ ì‹œ**
```
ì‹œìŠ¤í…œ ì²˜ë¦¬:
1. Day 5 ë„ë‹¬ í™•ì¸
2. ëª¨ë“  ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­ëœ ì´ë©”ì¼ ì¡°íšŒ
3. day5 íŒŒì¼ ìˆ˜ì§‘:
   - E05 â†’ e05_5day_enhanced_04_gps_analysis.md
   - E06 â†’ e06_5day_enhanced_01_drug_family.md
   - E07 â†’ e07_5day_enhanced_01_final_warning.md
   - E09 â†’ e09_5day_enhanced_01_netflix_log.md

4. E15 ì´ë©”ì¼ ìƒì„±:
   - ìœ„ 4ê°œ íŒŒì¼ì„ ëª¨ë‘ ì²¨ë¶€
   - subject: "ë³´ê°•ìˆ˜ì‚¬ ìµœì¢… ë¶„ì„ ê²°ê³¼"
```

**Day 5 (ê¸ˆìš”ì¼)**
```
í”Œë ˆì´ì–´:
1. E15 ì´ë©”ì¼ í™•ì¸ (ìƒˆ ì´ë©”ì¼)
2. ì²¨ë¶€íŒŒì¼ 4ê°œ í™•ì¸
3. ê²°ì •ì  ì¦ê±° íšë“
4. ì§„ë²” í™•ì‹ 
```

### 3.2 Edge Case: ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­ ì•ˆ í•œ ê²½ìš°

**í”Œë ˆì´ì–´ê°€ E05 ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­ ì•ˆ í•¨:**

**Day 3**: E05 ë³€í™” ì—†ìŒ

**Day 5**:
- E15 ë„ì°©
- E05ì˜ day5 íŒŒì¼ **ì²¨ë¶€ ì•ˆ ë¨**
- ë‹¤ë¥¸ ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­í•œ ì´ë©”ì¼ì˜ day5 íŒŒì¼ë§Œ ì²¨ë¶€

**ê²°ê³¼**: í”Œë ˆì´ì–´ê°€ ì¤‘ìš”í•œ ì¦ê±° ë†“ì¹¨ (ê²Œì„ ë””ìì¸ ì˜ë„)

---

## 4. ë°ì´í„° êµ¬ì¡° ì„¤ê³„

### 4.1 GameState í™•ì¥

```dart
// lib/data/models/game_state.dart
@HiveType(typeId: 0)
class GameState {
  @HiveField(0)
  int currentDay;

  @HiveField(1)
  DateTime currentTime;

  @HiveField(2)
  int tokenBalance;

  @HiveField(3)
  List<String> readEmailIds;

  @HiveField(4)
  List<String> unlockedEvidenceIds;

  @HiveField(5)
  Map<String, String> suspectNotes;

  @HiveField(6)
  List<String> completedEnhancedInvestigations;  // âš ï¸ ì‚¬ìš© ì•ˆ í•¨ (ì‚­ì œ ì˜ˆì •)

  @HiveField(7)
  bool canSubmitAnswer;

  @HiveField(8)
  String? submittedSuspect;

  // â­ ì‹ ê·œ í•„ë“œ
  @HiveField(9)
  List<String> requestedEnhancedInvestigations;  // ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­í•œ ì´ë©”ì¼ ID ëª©ë¡
  // ì˜ˆ: ["E02", "E05", "E06"]

  @HiveField(10)
  Map<String, List<String>> emailEnhancedFiles;  // ì´ë©”ì¼ë³„ ì¶”ê°€ëœ enhanced íŒŒì¼ ê²½ë¡œ
  // ì˜ˆ: {"E05": ["enhanced/e05_enhanced_02_...", "enhanced/e05_enhanced_03_..."]}

  @HiveField(11)
  List<String> day5EnhancedFilesToDeliver;  // Day 5ì— E15ë¡œ ì „ë‹¬í•  íŒŒì¼ ëª©ë¡
  // ì˜ˆ: ["enhanced/e05_5day_enhanced_04_...", "enhanced/e06_5day_enhanced_01_..."]

  GameState({
    required this.currentDay,
    required this.currentTime,
    required this.tokenBalance,
    required this.readEmailIds,
    required this.unlockedEvidenceIds,
    required this.suspectNotes,
    required this.completedEnhancedInvestigations,
    required this.canSubmitAnswer,
    this.submittedSuspect,
    this.requestedEnhancedInvestigations = const [],
    this.emailEnhancedFiles = const {},
    this.day5EnhancedFilesToDeliver = const [],
  });

  // ë³µì‚¬ ë©”ì„œë“œ
  GameState copyWith({
    int? currentDay,
    DateTime? currentTime,
    int? tokenBalance,
    List<String>? readEmailIds,
    List<String>? unlockedEvidenceIds,
    Map<String, String>? suspectNotes,
    List<String>? completedEnhancedInvestigations,
    bool? canSubmitAnswer,
    String? submittedSuspect,
    List<String>? requestedEnhancedInvestigations,
    Map<String, List<String>>? emailEnhancedFiles,
    List<String>? day5EnhancedFilesToDeliver,
  }) {
    return GameState(
      currentDay: currentDay ?? this.currentDay,
      currentTime: currentTime ?? this.currentTime,
      tokenBalance: tokenBalance ?? this.tokenBalance,
      readEmailIds: readEmailIds ?? this.readEmailIds,
      unlockedEvidenceIds: unlockedEvidenceIds ?? this.unlockedEvidenceIds,
      suspectNotes: suspectNotes ?? this.suspectNotes,
      completedEnhancedInvestigations: completedEnhancedInvestigations ?? this.completedEnhancedInvestigations,
      canSubmitAnswer: canSubmitAnswer ?? this.canSubmitAnswer,
      submittedSuspect: submittedSuspect ?? this.submittedSuspect,
      requestedEnhancedInvestigations: requestedEnhancedInvestigations ?? this.requestedEnhancedInvestigations,
      emailEnhancedFiles: emailEnhancedFiles ?? this.emailEnhancedFiles,
      day5EnhancedFilesToDeliver: day5EnhancedFilesToDeliver ?? this.day5EnhancedFilesToDeliver,
    );
  }

  factory GameState.initial() {
    return GameState(
      currentDay: 1,
      currentTime: DateTime(2025, 10, 28, 10, 0),
      tokenBalance: 500,
      readEmailIds: [],
      unlockedEvidenceIds: [],
      suspectNotes: {},
      completedEnhancedInvestigations: [],
      canSubmitAnswer: false,
      requestedEnhancedInvestigations: [],
      emailEnhancedFiles: {},
      day5EnhancedFilesToDeliver: [],
    );
  }
}
```

### 4.2 Enhanced Mapping ëª¨ë¸

```dart
// lib/data/models/enhanced_mapping.dart
@JsonSerializable()
class EnhancedMapping {
  final String emailId;
  final List<String> normalFiles;  // Type A: ë‹¤ìŒë‚  ì›ë˜ ì´ë©”ì¼ì— ì¶”ê°€
  final List<String> day5Files;    // Type B: Day 5 E15ì— ì¶”ê°€

  EnhancedMapping({
    required this.emailId,
    required this.normalFiles,
    required this.day5Files,
  });

  factory EnhancedMapping.fromJson(Map<String, dynamic> json) => _$EnhancedMappingFromJson(json);
  Map<String, dynamic> toJson() => _$EnhancedMappingToJson(this);
}
```

### 4.3 Email ëª¨ë¸ í™•ì¥

```dart
// lib/data/models/email.dart
@JsonSerializable()
class Email {
  final String id;
  final int day;
  final EmailSender sender;
  final String receiver;
  final DateTime timestamp;
  final String subject;
  final int importance;
  final bool? isUrgent;
  final bool hasAttachments;
  final int? attachmentCount;
  final EmailBody body;
  final List<EmailAttachment> attachments;

  // â­ ì‹ ê·œ í•„ë“œ (ëŸ°íƒ€ì„ì—ë§Œ ì‚¬ìš©, JSON ì§ë ¬í™” ì•ˆ í•¨)
  @JsonKey(includeFromJson: false, includeToJson: false)
  bool hasNewEnhancedFiles;  // ë³´ê°•ìˆ˜ì‚¬ íŒŒì¼ ì¶”ê°€ë¨ í‘œì‹œ

  @JsonKey(includeFromJson: false, includeToJson: false)
  List<String> enhancedFilePaths;  // ì¶”ê°€ëœ enhanced íŒŒì¼ ê²½ë¡œ ëª©ë¡

  Email({
    required this.id,
    required this.day,
    required this.sender,
    required this.receiver,
    required this.timestamp,
    required this.subject,
    required this.importance,
    this.isUrgent,
    required this.hasAttachments,
    this.attachmentCount,
    required this.body,
    required this.attachments,
    this.hasNewEnhancedFiles = false,
    this.enhancedFilePaths = const [],
  });

  // ë³´ê°•ìˆ˜ì‚¬ íŒŒì¼ ì¶”ê°€
  Email withEnhancedFiles(List<String> files) {
    return Email(
      id: id,
      day: day,
      sender: sender,
      receiver: receiver,
      timestamp: timestamp,
      subject: subject,
      importance: importance,
      isUrgent: isUrgent,
      hasAttachments: true,
      attachmentCount: (attachmentCount ?? attachments.length) + files.length,
      body: body,
      attachments: attachments,
      hasNewEnhancedFiles: true,
      enhancedFilePaths: files,
    );
  }

  factory Email.fromJson(Map<String, dynamic> json) => _$EmailFromJson(json);
  Map<String, dynamic> toJson() => _$EmailToJson(this);
}
```

---

## 5. í•µì‹¬ ë¡œì§ êµ¬í˜„

### 5.1 EnhancedInvestigationRepository

```dart
// lib/data/repositories/enhanced_investigation_repository.dart
class EnhancedInvestigationRepository {
  final AssetLoader _assetLoader;

  EnhancedInvestigationRepository(this._assetLoader);

  // enhanced_mappings.json ë¡œë“œ
  Future<Map<String, EnhancedMapping>> loadMappings() async {
    final jsonString = await _assetLoader.loadString('assets/data/enhanced_mappings.json');
    final Map<String, dynamic> json = jsonDecode(jsonString);

    final mappings = <String, EnhancedMapping>{};
    json.forEach((emailId, data) {
      mappings[emailId] = EnhancedMapping.fromJson({
        'emailId': emailId,
        'normalFiles': data['normal'],
        'day5Files': data['day5'],
      });
    });

    return mappings;
  }

  // íŠ¹ì • ì´ë©”ì¼ì˜ normal íŒŒì¼ ê°€ì ¸ì˜¤ê¸°
  Future<List<String>> getNormalFiles(String emailId) async {
    final mappings = await loadMappings();
    return mappings[emailId]?.normalFiles ?? [];
  }

  // íŠ¹ì • ì´ë©”ì¼ì˜ day5 íŒŒì¼ ê°€ì ¸ì˜¤ê¸°
  Future<List<String>> getDay5Files(String emailId) async {
    final mappings = await loadMappings();
    return mappings[emailId]?.day5Files ?? [];
  }

  // Enhanced íŒŒì¼ ë‚´ìš© ë¡œë“œ
  Future<String> loadEnhancedFile(String path) async {
    return await _assetLoader.loadString('assets/$path');
  }
}
```

### 5.2 EnhancedInvestigationUseCase

```dart
// lib/domain/use_cases/enhanced_investigation_use_case.dart
class EnhancedInvestigationUseCase {
  final EnhancedInvestigationRepository _repository;
  final GameStateProvider _gameStateProvider;
  final TokenProvider _tokenProvider;

  static const int ENHANCED_COST = 50;

  EnhancedInvestigationUseCase(
    this._repository,
    this._gameStateProvider,
    this._tokenProvider,
  );

  // ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­
  Future<void> requestEnhancedInvestigation(String emailId) async {
    // 1. í† í° ì²´í¬
    if (!_tokenProvider.canAfford(ENHANCED_COST)) {
      throw InsufficientTokenException();
    }

    // 2. ì´ë¯¸ ìš”ì²­í–ˆëŠ”ì§€ ì²´í¬
    final gameState = _gameStateProvider.state;
    if (gameState.requestedEnhancedInvestigations.contains(emailId)) {
      throw AlreadyRequestedException();
    }

    // 3. í† í° ì°¨ê°
    _tokenProvider.spend(ENHANCED_COST);

    // 4. ìš”ì²­ ëª©ë¡ì— ì¶”ê°€
    final newRequested = [...gameState.requestedEnhancedInvestigations, emailId];

    // 5. GameState ì—…ë°ì´íŠ¸
    _gameStateProvider.updateState(
      gameState.copyWith(
        requestedEnhancedInvestigations: newRequested,
      ),
    );
  }

  // ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­ ì—¬ë¶€ í™•ì¸
  bool isRequested(String emailId) {
    final gameState = _gameStateProvider.state;
    return gameState.requestedEnhancedInvestigations.contains(emailId);
  }

  // Enhanced íŒŒì¼ì´ ì¶”ê°€ë˜ì—ˆëŠ”ì§€ í™•ì¸
  bool hasEnhancedFiles(String emailId) {
    final gameState = _gameStateProvider.state;
    return gameState.emailEnhancedFiles.containsKey(emailId);
  }

  // íŠ¹ì • ì´ë©”ì¼ì˜ Enhanced íŒŒì¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
  List<String> getEnhancedFiles(String emailId) {
    final gameState = _gameStateProvider.state;
    return gameState.emailEnhancedFiles[emailId] ?? [];
  }
}
```

### 5.3 DayTransitionService (í•µì‹¬ ë¡œì§)

```dart
// lib/data/services/day_transition_service.dart
class DayTransitionService {
  final GameStateProvider _gameStateProvider;
  final EmailRepository _emailRepository;
  final EnhancedInvestigationRepository _enhancedRepository;

  DayTransitionService(
    this._gameStateProvider,
    this._emailRepository,
    this._enhancedRepository,
  );

  // Day ì „í™˜ ì‹œ í˜¸ì¶œ
  Future<void> advanceToNextDay() async {
    final currentState = _gameStateProvider.state;
    final currentDay = currentState.currentDay;
    final nextDay = currentDay + 1;

    // 1. ë³´ê°•ìˆ˜ì‚¬ ì²˜ë¦¬
    await _processEnhancedInvestigations(currentState, nextDay);

    // 2. GameState ì—…ë°ì´íŠ¸ (Day ì§„í–‰)
    _gameStateProvider.updateState(
      currentState.copyWith(
        currentDay: nextDay,
        currentTime: _calculateNextDayTime(currentDay),
        canSubmitAnswer: nextDay == 5,  // Day 5ë§Œ ì œì¶œ ê°€ëŠ¥
      ),
    );

    // 3. Day 5 íŠ¹ìˆ˜ ì²˜ë¦¬
    if (nextDay == 5) {
      await _createE15Email(currentState);
    }
  }

  // ë³´ê°•ìˆ˜ì‚¬ íŒŒì¼ ì²˜ë¦¬
  Future<void> _processEnhancedInvestigations(
    GameState gameState,
    int nextDay,
  ) async {
    final requestedEmails = gameState.requestedEnhancedInvestigations;

    if (requestedEmails.isEmpty) return;

    final newEmailEnhancedFiles = Map<String, List<String>>.from(gameState.emailEnhancedFiles);
    final day5FilesToDeliver = List<String>.from(gameState.day5EnhancedFilesToDeliver);
    final updatedReadEmails = List<String>.from(gameState.readEmailIds);

    for (final emailId in requestedEmails) {
      // ì´ë¯¸ ì²˜ë¦¬ëœ ê²½ìš° ìŠ¤í‚µ
      if (newEmailEnhancedFiles.containsKey(emailId)) continue;

      // Normal íŒŒì¼ ê°€ì ¸ì˜¤ê¸°
      final normalFiles = await _enhancedRepository.getNormalFiles(emailId);

      if (normalFiles.isNotEmpty) {
        // Normal íŒŒì¼ ì¶”ê°€
        newEmailEnhancedFiles[emailId] = normalFiles;

        // ì´ë©”ì¼ì„ "ì•ˆì½ìŒ"ìœ¼ë¡œ ë³€ê²½
        updatedReadEmails.remove(emailId);
      }

      // Day 5 íŒŒì¼ ìˆ˜ì§‘ (ë‚˜ì¤‘ì— E15ë¡œ ì „ë‹¬)
      final day5Files = await _enhancedRepository.getDay5Files(emailId);
      if (day5Files.isNotEmpty) {
        day5FilesToDeliver.addAll(day5Files);
      }
    }

    // GameState ì—…ë°ì´íŠ¸
    _gameStateProvider.updateState(
      gameState.copyWith(
        emailEnhancedFiles: newEmailEnhancedFiles,
        day5EnhancedFilesToDeliver: day5FilesToDeliver,
        readEmailIds: updatedReadEmails,
      ),
    );
  }

  // Day 5 E15 ì´ë©”ì¼ ìƒì„±
  Future<void> _createE15Email(GameState gameState) async {
    final day5Files = gameState.day5EnhancedFilesToDeliver;

    if (day5Files.isEmpty) {
      // ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­ ì•ˆ í–ˆìœ¼ë©´ E15 ìƒì„± ì•ˆ í•¨
      return;
    }

    // E15 ì´ë©”ì¼ í…œí”Œë¦¿ ë¡œë“œ
    final e15Template = await _emailRepository.loadEmail('E15');

    // Day 5 íŒŒì¼ë“¤ì„ ì²¨ë¶€íŒŒì¼ë¡œ ì¶”ê°€
    final enhancedAttachments = day5Files.map((path) {
      final filename = path.split('/').last.replaceAll('.md', '.pdf');
      return EmailAttachment(
        assetId: path,
        filename: filename,
        type: 'application/pdf',
        size: '1.2 MB',
      );
    }).toList();

    final e15WithAttachments = e15Template.copyWith(
      attachments: [...e15Template.attachments, ...enhancedAttachments],
      attachmentCount: e15Template.attachments.length + enhancedAttachments.length,
    );

    // E15 ì´ë©”ì¼ ì €ì¥ (EmailRepositoryì— ì¶”ê°€)
    await _emailRepository.saveEmail(e15WithAttachments);
  }

  DateTime _calculateNextDayTime(int currentDay) {
    // Dayë³„ ì‹œê°„ ì„¤ì •
    final baseDate = DateTime(2025, 10, 28);
    return baseDate.add(Duration(days: currentDay));
  }
}
```

---

## 6. E15 ì´ë©”ì¼ ì„¤ê³„

### 6.1 E15 ì´ë©”ì¼ ë‚´ìš© (ìˆ˜ì • í•„ìš”)

**í˜„ì¬ ìƒíƒœ**: e14ì˜ ë³µì‚¬ë³¸ (ê¹€ìˆ˜í˜„ PC ë³µêµ¬ ë‚´ìš©)

**ìˆ˜ì • í›„ ë‚´ìš©**:

```json
{
  "id": "E15",
  "day": 5,
  "sender": {
    "name": "í”„ë¡œíŒŒì¼ë§ì„¼í„°",
    "department": "ì¢…í•© ë¶„ì„íŒ€",
    "title": "ë³´ê°•ìˆ˜ì‚¬ ì´ê´„"
  },
  "receiver": "í”„ë¡œíŒŒì¼ë§ì„¼í„°",
  "timestamp": "2025-11-01T09:00:00",
  "subject": "â­ ë³´ê°•ìˆ˜ì‚¬ ìµœì¢… ë¶„ì„ ê²°ê³¼",
  "importance": 5,
  "isUrgent": true,
  "hasAttachments": true,
  "body": {
    "urgentNotice": "â­ ê¸´ê¸‰: ë³´ê°•ìˆ˜ì‚¬ë¡œ ìš”ì²­í•˜ì‹  ì‹¬ì¸µ ë¶„ì„ ê²°ê³¼ê°€ ë„ì°©í–ˆìŠµë‹ˆë‹¤!",
    "sections": [
      {
        "title": "ë³´ê°•ìˆ˜ì‚¬ ê°œìš”",
        "content": [
          "ì§€ë‚œ 4ì¼ê°„ ìš”ì²­í•˜ì‹  ë³´ê°•ìˆ˜ì‚¬ë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.",
          "",
          "ê° íŒ€ì—ì„œ ì¶”ê°€ ì¡°ì‚¬í•œ ê²°ê³¼ë¥¼ í†µí•©í•˜ì—¬ ì „ë‹¬ë“œë¦½ë‹ˆë‹¤.",
          "ëª¨ë“  ë¶„ì„ ë³´ê³ ì„œë¥¼ ì²¨ë¶€íŒŒì¼ë¡œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤."
        ]
      },
      {
        "title": "ì²¨ë¶€ íŒŒì¼ ëª©ë¡",
        "content": [
          "ì²¨ë¶€ëœ ëª¨ë“  íŒŒì¼ì€ ì‚¬ê±´ í•´ê²°ì˜ ê²°ì •ì  ì¦ê±°ê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
          "",
          "ì£¼ìš” ë¶„ì„ ë‚´ìš©:",
          "- GPS ë° ì°¨ëŸ‰ ë¸”ë™ë°•ìŠ¤ êµì°¨ ê²€ì¦",
          "- ë””ê³¡ì‹  ì²˜ë°© ê¸°ë¡ ì¶”ì ",
          "- ìµœí›„í†µì²© ë…¹ì·¨ë¡ ë³µì›",
          "- ë„·í”Œë¦­ìŠ¤ ì ‘ì† ë¡œê·¸ ìƒì„¸ ë¶„ì„",
          "",
          "âš ï¸ ëª¨ë“  ìë£Œë¥¼ ì‹ ì¤‘íˆ ê²€í† í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.",
          "ì¼ë¶€ ì •ë³´ëŠ” ìš©ì˜ìë“¤ì˜ ì§„ìˆ ê³¼ ìƒì¶©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
        ]
      },
      {
        "title": "ë¶„ì„ íŒ€ ì˜ê²¬",
        "content": [
          "ì´ë²ˆ ë³´ê°•ìˆ˜ì‚¬ë¥¼ í†µí•´ ëª‡ ê°€ì§€ ì¤‘ìš”í•œ ì‚¬ì‹¤ì´ ë°í˜€ì¡ŒìŠµë‹ˆë‹¤.",
          "",
          "1. ìš©ì˜ìë“¤ì˜ ì•Œë¦¬ë°”ì´ì— ì˜ë¬¸ì  ë°œê²¬",
          "2. ë²”í–‰ ë„êµ¬ì˜ ì¶œì²˜ í™•ì¸",
          "3. ë²”í–‰ ë™ê¸°ì˜ ëª…í™•í™”",
          "",
          "ìµœì¢… íŒë‹¨ì€ ìˆ˜ì‚¬ê´€ë‹˜ê»˜ ë‹¬ë ¤ìˆìŠµë‹ˆë‹¤.",
          "ì‹ ì¤‘íˆ ê²€í† í•˜ì‹  í›„ ì œì¶œí•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤."
        ]
      }
    ],
    "closing": "ë³´ê°•ìˆ˜ì‚¬ ê²°ê³¼ë¥¼ ì²¨ë¶€í•©ë‹ˆë‹¤. ìµœì¢… ì œì¶œ ì „ ë°˜ë“œì‹œ í™•ì¸í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.\n\n- í”„ë¡œíŒŒì¼ë§ì„¼í„° ì¢…í•© ë¶„ì„íŒ€"
  },
  "attachments": [
    // â­ ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ (Day 5 íŒŒì¼ë“¤)
    // {
    //   "assetId": "enhanced/e05_5day_enhanced_04_gps_analysis.md",
    //   "filename": "GPS_êµì°¨ê²€ì¦_ìµœì¢….pdf",
    //   "type": "application/pdf",
    //   "size": "2.1 MB"
    // },
    // ...
  ]
}
```

### 6.2 E15 ìƒì„± ë¡œì§ ìš”ì•½

**ì¡°ê±´**: Day 5 ë„ë‹¬ AND day5EnhancedFilesToDeliverê°€ ë¹„ì–´ìˆì§€ ì•ŠìŒ

**ìƒì„± ë°©ë²•**:
1. e15_enhancedmail.json í…œí”Œë¦¿ ë¡œë“œ
2. day5EnhancedFilesToDeliverì˜ íŒŒì¼ë“¤ì„ attachmentsì— ì¶”ê°€
3. ìµœì¢… Email ê°ì²´ ìƒì„±
4. EmailRepositoryì— ë“±ë¡

**ê²°ê³¼**:
- ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­í•œ ê²½ìš°: E15 ë„ì°© (ì²¨ë¶€íŒŒì¼ 1-4ê°œ)
- ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­ ì•ˆ í•œ ê²½ìš°: E15 ë„ì°© ì•ˆ í•¨ (ë˜ëŠ” ì²¨ë¶€íŒŒì¼ 0ê°œ)

---

## 7. í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### 7.1 ì‹œë‚˜ë¦¬ì˜¤ A: ëª¨ë“  ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­

**Day 1:**
- E02 ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­ âœ…

**Day 2:**
- E02 ì•ˆì½ìŒ + 3ê°œ íŒŒì¼ ì¶”ê°€ âœ…
- E05, E06 ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­ âœ…

**Day 3:**
- E05 ì•ˆì½ìŒ + 2ê°œ íŒŒì¼ ì¶”ê°€ (e05_enhanced_02, e05_enhanced_03) âœ…
- E06 ë³€í™” ì—†ìŒ (normal íŒŒì¼ 0ê°œ) âœ…
- E07, E09 ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­ âœ…

**Day 4:**
- E07, E09 ë³€í™” ì—†ìŒ (ë‘˜ ë‹¤ normal íŒŒì¼ 0ê°œ) âœ…

**Day 5:**
- E15 ë„ì°© âœ…
- ì²¨ë¶€íŒŒì¼ 4ê°œ:
  - e05_5day_enhanced_04_gps_analysis.md
  - e06_5day_enhanced_01_drug_family.md
  - e07_5day_enhanced_01_final_warning.md
  - e09_5day_enhanced_01_netflix_log.md

**ì˜ˆìƒ ê²°ê³¼**: ì™„ë²½í•œ ì¦ê±° ìˆ˜ì§‘ âœ…

### 7.2 ì‹œë‚˜ë¦¬ì˜¤ B: ì¼ë¶€ë§Œ ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­

**Day 1:**
- E02 ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­ âœ…

**Day 2:**
- E02 ì•ˆì½ìŒ + 3ê°œ íŒŒì¼ ì¶”ê°€ âœ…
- E05 ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­ ì•ˆ í•¨ âŒ

**Day 5:**
- E15 ë„ì°© âœ…
- ì²¨ë¶€íŒŒì¼ 0ê°œ (E05 ìš”ì²­ ì•ˆ í•´ì„œ e05_5day íŒŒì¼ ì—†ìŒ)

**ì˜ˆìƒ ê²°ê³¼**: ì¤‘ìš”í•œ ì¦ê±° ëˆ„ë½ (GPS êµì°¨ ê²€ì¦ ëª» ë´„) âŒ

### 7.3 ì‹œë‚˜ë¦¬ì˜¤ C: ë³´ê°•ìˆ˜ì‚¬ ì „í˜€ ì•ˆ í•¨

**Day 1-4:**
- ì•„ë¬´ ë³€í™” ì—†ìŒ

**Day 5:**
- E15 ë„ì°© ì•ˆ í•¨ (day5EnhancedFilesToDeliverê°€ ë¹”)
- ë˜ëŠ” E15 ë„ì°©í•˜ì§€ë§Œ ì²¨ë¶€íŒŒì¼ 0ê°œ

**ì˜ˆìƒ ê²°ê³¼**: ê²Œì„ ë‚œì´ë„ ìµœê³  (ê¸°ë³¸ ì¦ê±°ë§Œìœ¼ë¡œ ì¶”ë¦¬í•´ì•¼ í•¨) â­â­â­â­â­

---

## 8. êµ¬í˜„ ìš°ì„ ìˆœìœ„

### Phase 2 Week 4-5: ë°ì´í„° ëª¨ë¸

1. âœ… GameState í•„ë“œ ì¶”ê°€
2. âœ… EnhancedMapping ëª¨ë¸ ì‘ì„±
3. âœ… Email ëª¨ë¸ í™•ì¥
4. âœ… enhanced_mappings.json ì‘ì„±

### Phase 2 Week 6: ë¡œì§ êµ¬í˜„

1. âœ… EnhancedInvestigationRepository êµ¬í˜„
2. âœ… EnhancedInvestigationUseCase êµ¬í˜„
3. âœ… DayTransitionService êµ¬í˜„
4. âœ… E15 ì´ë©”ì¼ ë‚´ìš© ìˆ˜ì •

### Phase 3: UI ì—°ê²°

1. ì´ë©”ì¼ ìƒì„¸ í™”ë©´ì— "ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­" ë²„íŠ¼ ì¶”ê°€
2. ì´ë©”ì¼ ëª©ë¡ì—ì„œ "ì•ˆì½ìŒ" í‘œì‹œ
3. Enhanced ì²¨ë¶€íŒŒì¼ ë Œë”ë§
4. E15 ì´ë©”ì¼ í‘œì‹œ

---

## 9. ì£¼ì˜ì‚¬í•­ âš ï¸

### 9.1 ë³µì¡ë„ ê´€ë¦¬

**ì´ ì‹œìŠ¤í…œì€ ë§¤ìš° ë³µì¡í•©ë‹ˆë‹¤:**
- 3ê°€ì§€ ìƒíƒœ ê´€ë¦¬ (ìš”ì²­, normal ì¶”ê°€, day5 ìˆ˜ì§‘)
- ë™ì  ì´ë©”ì¼ ìƒì„± (E15)
- Day ì „í™˜ íƒ€ì´ë° ì²˜ë¦¬

**ê¶Œì¥ ê°œë°œ ë°©ì‹:**
1. ë°ì´í„° ëª¨ë¸ë¶€í„° ì™„ë²½íˆ êµ¬í˜„
2. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±
3. ë¡œì§ì„ ì‘ì€ í•¨ìˆ˜ë¡œ ë¶„ë¦¬
4. ê° ë‹¨ê³„ë³„ë¡œ ë¡œê·¸ ì¶œë ¥í•˜ì—¬ ë””ë²„ê¹…

### 9.2 í…ŒìŠ¤íŠ¸ í•„ìˆ˜

**ë°˜ë“œì‹œ í…ŒìŠ¤íŠ¸í•´ì•¼ í•  ì¼€ì´ìŠ¤:**
- [ ] ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­ â†’ ë‹¤ìŒë‚  íŒŒì¼ ì¶”ê°€ í™•ì¸
- [ ] ì´ë©”ì¼ "ì•ˆì½ìŒ" ì „í™˜ í™•ì¸
- [ ] Day 5 E15 ìƒì„± í™•ì¸
- [ ] ë³´ê°•ìˆ˜ì‚¬ ì•ˆ í•œ ê²½ìš° E15 ë¯¸ìƒì„± í™•ì¸
- [ ] ì¼ë¶€ë§Œ ìš”ì²­í•œ ê²½ìš° E15 ì¼ë¶€ ì²¨ë¶€ í™•ì¸

### 9.3 ì‚¬ìš©ì ê²½í—˜

**í”Œë ˆì´ì–´ ê´€ì :**
- ë³´ê°•ìˆ˜ì‚¬ëŠ” ë¹„ìš©ì´ í¬ë¯€ë¡œ ì‹ ì¤‘íˆ ì„ íƒ
- ë³´ê°•ìˆ˜ì‚¬ ì•ˆ í•˜ë©´ ì¦ê±° ëˆ„ë½ ê°€ëŠ¥
- Day 5 ê²°ì •ì  ì¦ê±°ëŠ” ë³´ê°•ìˆ˜ì‚¬ ì—†ì´ ëª» ë´„

**ê²Œì„ ë°¸ëŸ°ìŠ¤:**
- ëª¨ë“  ë³´ê°•ìˆ˜ì‚¬ ìš”ì²­: í† í° 200-250 ì†Œëª¨
- ì´ˆê¸° í† í° 500 â†’ ë³´ê°•ìˆ˜ì‚¬ 4-5ê°œ ê°€ëŠ¥
- AI ë¶„ì„ë„ í•´ì•¼ í•˜ë¯€ë¡œ ì‹ ì¤‘í•œ ì„ íƒ í•„ìš”

---

**ì‘ì„±ì**: Claude Code Assistant
**ì‘ì„±ì¼**: 2025-10-06
**ë²„ì „**: 1.0
**ë‚œì´ë„**: â­â­â­â­â­

**ì¤‘ìš”**: ì´ ì‹œìŠ¤í…œì€ ê²Œì„ì˜ í•µì‹¬ ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤. ì‹ ì¤‘í•˜ê²Œ êµ¬í˜„í•˜ê³  ì¶©ë¶„íˆ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”!
